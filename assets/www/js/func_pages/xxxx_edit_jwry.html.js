function init(){if("PMUPDATE"===procmode){var a=getArgs().all_full_addr;$(".top-title").html("境外人员移动"),$("#quxcun").html("转移地址："+a),$("#all_full_addr").html("原地址："+all_full_addr),$('input[name="systemid"]').val(getArgs().systemid),$('input[name="all_full_addr"]').val(a),$('input[name="procmode"]').val("PMINSERT")}else $("#quxcun").html(quxcun),$("#all_full_addr").html(all_full_addr),$('input[name="systemid"]').val(systemid),$('input[name="all_full_addr"]').val(all_full_addr),$('input[name="procmode"]').val(procmode);"PMINSERT"==procmode?prepare_for_new():"PMUPDATE"==procmode?prepare_for_edit():"PMDETAIL"==procmode&&prepare_for_watch()}function prepare_for_new(){$('input[name="czlx"]').val("xz")}function prepare_for_edit(){$('input[name="czlx"]').val("xz");var a=getArgs().rkbm,t=new AjaxJsonRequest("syrk_jwry_list.jsp");t.setData("rkbm",a),t.send("获取境外人员详情中...",function(a){a.datas.length>0?loadDataToForm(a.datas[0]):$.alert("查询境外人员详情失败!")},function(a){$.alert("获取境外人员详情失败!")})}function prepare_for_watch(){$("#save_btn_div").hide();var a=getArgs().rkbm,t=new AjaxJsonRequest("syrk_jwry_list.jsp");t.setData("rkbm",a),t.send("获取境外人员详情中...",function(a){a.datas.length>0?(loadDataToForm(a.datas[0]),closeAllInput("form")):($.alert("查询境外人员详情失败!"),closeAllInput("form"))},function(a){$.alert("获取境外人员详情失败!"),closeAllInput("form")})}function common_prepare(){}function sendReq(){var a=$('input[name="ywx"]').val().trim(),t=$('input[name="ywm"]').val().trim(),n=$('input[name="zwxm"]').val().trim();if(!(a&&t||n))return void $.alert("英文姓英文名和中文姓名至少需要填写一项!");var l=new AjaxJsonRequest("syrk_jwry_save.jsp");l.loadDataFromForm("form");var e=new NotNullField;e.add("rylx","人员类型"),e.add("csrq","出生日期"),e.add("gj","国籍"),e.add("xb","性别"),e.add("zjlx","证件类型"),e.add("zjhm","证件号码"),e.add("lxfs","联系方式"),e.add("zzsy","来厦事由"),e.add("tlyxqx","停留有效期限"),l.setNotNotNullField(e),l.send("境外人员信息提交中...",function(a){showTchToast("境外人员保存成功 ","-1",function(){go_back()})},function(a){$.alert("境外人员保存失败，"+a)})}function click_dwmc(){$.modal({title:"单位名称",buttons:[{text:"手动输入",onClick:function(){$('input[name="yqdw_mc"]').removeAttr("readOnly"),$('input[name="yqdw_mc"]').focus(),$('input[name="yqdw_mc"]').on("blur",function(){$('input[name="yqdw_mc"]').attr("readOnly","true")})}},{text:"自动引用",onClick:function(){openSearchDwDialog(quoteDwCallback)}}]})}function quoteDwCallback(a){a?($('input[name="yqdw_mc"]').val(a.frmc?a.frmc:""),$('input[name="lxdzbm"]').val(a.jydz?a.jydz:"")):$.alert("单位信息引用失败")}function go_back(){history.go(-1)}function openDict(a,t,n,l){openDictDialog(a,t,n,l)}function rylx_click(){openLocalDictDialogWithCallback("境外人员类型","境外人员类型本地","person_type","",rylc_callback)}var procmode=getArgs().procmode,quxcun=get_current_quxcun(),all_full_addr=get_current_all_full_addr(),systemid=get_current_system_id(),jwry_picker=new mui.DtPicker({type:"date",beginDate:new Date(1900,1,1),endDate:new Date(2099,12,31)}),rylc_callback=function(a,t){switch($("#gj").val(""),t){case"华侨":$("#gj").val(""),$("#zjlx").attr("onclick","openDict('华侨证件类型', '华侨证件类型', 'zjlx', 'zjlxbm')"),$("#zzsy").attr("onclick","openDict('港澳台侨停居留事由', '港澳台侨停居留事由', 'zzsy', 'zzsybm')"),$("#zjlx").val(""),$("#zzsy").val(""),$("#gaotai").hide(),$("#hqding").show();break;case"香港居民":$("#gj").val("香港"),$("#zjlx").attr("onclick","openDict('港澳居民证件类型', '港澳居民证件类型', 'zjlx', 'zjlxbm')"),$("#zzsy").attr("onclick","openDict('港澳台侨停居留事由', '港澳台侨停居留事由', 'zzsy', 'zzsybm')"),$("#zjlx").val(""),$("#zzsy").val(""),$("#gaotai").show(),$("#hqding").hide();break;case"台湾居民":$("#gj").val("中国台湾"),$("#zjlx").attr("onclick","openDict('台湾居民证件类型', '台湾居民证件类型', 'zjlx', 'zjlxbm')"),$("#zzsy").attr("onclick","openDict('港澳台侨停居留事由', '港澳台侨停居留事由', 'zzsy', 'zzsybm')"),$("#zjlx").val(""),$("#zzsy").val(""),$("#gaotai").show(),$("#hqding").hide();break;case"澳门居民":$("#gj").val("澳门"),$("#zjlx").attr("onclick","openDict('港澳居民证件类型', '港澳居民证件类型', 'zjlx', 'zjlxbm')"),$("#zzsy").attr("onclick","openDict('港澳台侨停居留事由', '港澳台侨停居留事由', 'zzsy', 'zzsybm')"),$("#zjlx").val(""),$("#zzsy").val(""),$("#gaotai").show(),$("#hqding").hide();break;default:$("#gj").val(""),$("#zjlx").attr("onclick","openDict('外国人证件类型', '外国人证件类型', 'zjlx', 'zjlxbm')"),$("#zzsy").attr("onclick","openDict('外国人停居留事由', '外国人停居留事由', 'zzsy', 'zzsybm')"),$("#zjlx").val(""),$("#zzsy").val(""),$("#gaotai").hide(),$("#hqding").hide()}};$(function(){$("#csrq").click(function(){jwry_picker.show(function(a){$("#csrq").val(a.text)})}),$("#fo_zjqx").click(function(){jwry_picker.show(function(a){$("#fo_zjqx").val(a.text)})}),$("#tlyxqx").click(function(){jwry_picker.show(function(a){$("#tlyxqx").val(a.text)})}),$("#lxsj").click(function(){jwry_picker.show(function(a){$("#lxsj").val(a.text)})}),$("#rjrq").click(function(){jwry_picker.show(function(a){$("#rjrq").val(a.text)})}),$('input[name="zjhm"]').blur(function(){var a,t=$('input[name="zjlx"]').val(),n=$('input[name="zjhm"]').val().toUpperCase();$('input[name="zjhm"]').val(n);var l=$('input[name="gj"]').val();"普通护照"===t?("台湾"===l&&(l="中国台湾"),a=new AjaxJsonRequest("bjrk_jwrk_list.jsp"),a.setData("gj",l),a.setData("zjlx",t),a.setData("zjhm",n)):"港澳居民来往内地通行证"===t&&11===n.length?(a=new AjaxJsonRequest("bjrk_gat_list.jsp"),a.setData("paperno",n.substring(0,9)),a.setData("versionno",n.substring(9,11)),"H"===n.substring(0,1)||"h"===n.substring(0,1)?a.setData("areacode","香港"):"M"!==n.substring(0,1)&&"m"!==n.substring(0,1)||a.setData("areacode","澳门")):(a=new AjaxJsonRequest("syrk_jwry_list.jsp"),a.setData("zjlx",t),a.setData("zjhm",n)),a.send("正在获取境外人员信息",function(a){if(a.datas.length>0){var t=a.datas[0];$('input[name="zwxm"]').val(t.zwxm),$('input[name="ywx"]').val(t.ywx),$('input[name="ywm"]').val(t.ywm),$('input[name="xb"]').val(t.xb),$('input[name="csrq"]').val(t.csrq),$('input[name="jzcs"]').val(t.jzcs),$('input[name="tlyxqx"]').val(t.tlyxqx),$('input[name="fo_zjqx"]').val(t.fo_zjqx),$('input[name="rjka"]').val(t.rjka),$('input[name="rjrq"]').val(t.rjrq),$('input[name="lxfs"]').val(t.lxfs),$('input[name="zzsy"]').val(t.zzsy),$('input[name="yqdw_mc"]').val(t.yqdw_mc),$('input[name="lxdzmc"]').val(t.lxdzmc),$('input[name="lxdzbm"]').val(t.lxdzbm),$('input[name="lxtel"]').val(t.lxtel)}else $.alert("没有找到对应境外人员信息，请手动采集后保存")},function(a){$.alert("引用境外人员信息失败："+a)})})});