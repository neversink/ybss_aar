function init(){$("#quxcun").html(quxcun),$("#all_full_addr").html(all_full_addr),$('input[name="systemid"]').val(get_current_system_id()),$('input[name="all_full_addr"]').val(get_current_all_full_addr()),$('input[name="procmode"]').val(procmode),"PMUPDATE"==procmode?prepare_for_edit():"PMINSERT"==procmode?prepare_for_new():"PMDETAIL"==procmode&&prepare_for_watch()}function prepare_for_new(){$('input[name="czlx"]').val("xz")}function prepare_for_edit(){$('input[name="czlx"]').val("bg");var n=getCurrentDwItem();loadDataToForm(n),""==n.fzrzjlx&&$('input[name="fzrzjlx"]').val("居民身份证"),""==n.frzjlx&&$('input[name="frzjlx"]').val("居民身份证"),$('input[name="dwid"]').val(n.dwid)}function prepare_for_watch(){$("#save_btn").hide();var n=getArgs().dwid;if(n){var a=new AjaxJsonRequest("dw_list.jsp");a.setData("systemid",systemid),a.setData("dwid",n),a.send("单位信息获取中",function(n){loadDataToForm(n.datas[0]),closeAllInput("form")},function(n){$.alert("单位信息获取失败，"+n)})}else{var t=getCurrentDwItem();loadDataToForm(t),closeAllInput("form")}}function common_prepare(){}function quoteDwfrxx(n){var a=new AjaxJsonRequest("bd_dwfr_list.jsp");a.setData("sfzh",n),a.send("正在获取法人代表信息",function(n){if(n.datas.length>0){var a=n.datas[0];$('input[name="frxm"]').val(a.xm?a.xm:""),$('input[name="frlxfs"]').val(a.lxfs?a.lxfs:""),$('input[name="fr_person_id"]').val(a.frbh?a.frbh:"")}else $('input[name="frxm"]').val(""),$('input[name="frlxfs"]').val(""),$('input[name="fr_person_id"]').val(""),$.alert("没找到对应法人代表信息")},function(n){$.alert("获取法人代表信息失败，"+n)})}function click_dwmc(){$.modal({title:"单位名称",buttons:[{text:"手动输入",onClick:function(){$('input[name="dwmc"]').removeAttr("readOnly"),$('input[name="dwmc"]').focus(),$('input[name="dwmc"]').on("blur",function(){$('input[name="dwmc"]').attr("readOnly","true")})}},{text:"自动引用",onClick:function(){openSearchDwDialog(quoteDwCallback)}}]})}function quoteDwCallback(n){n?($('input[name="frxm"]').val(""),$('input[name="frlxfs"]').val(""),$('input[name="fzrzjhm"]').val(""),$('input[name="fzrxm"]').val(""),$('input[name="fzrlxfs"]').val(""),$('input[name="fr_person_id"]').val(""),$('input[name="dwmc"]').val(""),$('input[name="fzrxm"]').val(""),$('input[name="fzrlxfs"]').val(""),$('input[name="glr_person_id"]').val(""),$('input[name="dwmc"]').val(n.frmc?n.frmc:""),$('input[name="bl_code"]').val(n.zch?n.zch:""),$('input[name="org_code"]').val(n.zzjgdm?n.zzjgdm:""),$('input[name="dh"]').val(n.lxfs?n.lxfs:""),$('input[name="frxm"]').val(n.xm?n.xm:""),$('input[name="frzjhm"]').val(n.sfzh?n.sfzh:""),n.sfzh&&$('input[name="frzjhm"]').blur(),$('input[name="dh"]').val(n.lxfs?n.lxfs:"")):$.alert("单位信息引用失败")}function cant_change_dwmc(){$.alert("不可变更单位名称!")}function go_back(){history.go(-1)}function openDict(n,a,t,e){openDictDialog(n,a,t,e)}var procmode=getArgs().procmode,quxcun=get_current_quxcun(),all_full_addr=get_current_all_full_addr(),systemid=get_current_system_id();$(function(){$("#save_btn").click(function(){var n=new AjaxJsonRequest("dw_save.jsp");n.loadDataFromForm("form");var a=new NotNullField;a.add("dwmc","单位名称"),a.add("dwlb","行业类别"),a.add("bm","单位编码"),a.add("dwxz","单位性质"),a.add("fzrxm","负责人姓名"),a.add("fzrzjlx","负责人证件类型"),a.add("fzrzjhm","负责人证件号码"),a.add("fzrlxfs","负责人联系方式"),n.setNotNotNullField(a),n.send("单位信息提交中...",function(n){showTchToast("单位保存成功","-1",function(){go_back()})},function(n){$.alert("单位保存失败，"+n)})}),$('input[name="fzrzjhm"]').blur(function(){"居民身份证"==$('input[name="fzrzjlx"]').val()&&getSfzXx($('input[name="fzrzjhm"]').val(),"fzrxm","fzrlxfs","","","glr_person_id")}),$('input[name="frzjhm"]').blur(function(){var n=$('input[name="frzjhm"]').val();"居民身份证"==$('input[name="frzjlx"]').val()&&""!=n&&isIdCardNum(n)&&quoteDwfrxx(n)})});