function init(){if($.initPullToRefresh(".pull-to-refresh-content"),$(".to-top").toTop({}),$("#clear_btn").click(function(){saveSearchHistory(""),$("#history_list").empty()}),is_cache_search){var e;set_ss_type(is_cache_search.ctype),e="dw"===is_cache_search.ctype?getSsdwlb():getSsdzlb(),initPagination(is_cache_search.tsize,is_cache_search.cpage),common_success_cb(e)}else"true"===is_qr&&sessionStorage.qr_system_id?click_menu():showHistory()}function click_search_btn(){return kw=$("#search").val(),kw=trim(kw),is_search_sfz=!(18!=kw.length||!parseInt(kw.substring(1,17))),$("#dz_list_nodata").hide(),kw.length>30?void $.toast("搜索关键词过长！"):(keyword_eternal=kw,kw&&saveHistory(kw),void sendReq())}function click_search_item(e){$("#search").val(e),$(".searchbar-cancel").click()}function click_search_tab(){keyword_eternal=$("#search").val(),sendReq()}function showHistory(){if(localStorage.search_history)for(var e=localStorage.search_history.split(","),t=distinct(e),s=0;s<t.length;s++){var a=createHistoryItem(t[s]);$("#history_list").append(a)}$("#history_content").fadeIn()}function saveHistory(e){localStorage.search_history?localStorage.search_history+=","+e:localStorage.search_history=e}function set_img_type(e){if(unselect_all(),""!==e)switch(e){case"mfssmp":$("#fw_icon").attr("src","img/doorplate.png");break;case"mfssxq":$("#xq_icon").attr("src","img/village.png");break;case"mfssjzw":$("#ld_icon").attr("src","img/building.png");break;case"dw":$("#dw_icon").attr("src","img/department.png")}}function unselect_all(){$("#fw_icon").attr("src","img/doorplate_g.png"),$("#xq_icon").attr("src","img/village_g.png"),$("#ld_icon").attr("src","img/building_g.png"),$("#dw_icon").attr("src","img/department_g.png")}function click_menu(e){1==e?set_ss_type("mfssmp"):2==e?set_ss_type("mfssxq"):3==e?set_ss_type("mfssjzw"):4==e&&set_ss_type("dw"),click_search_tab()}function set_ss_type(e){ss_type_last=ss_type,ss_type=ss_type==e?"":e}function sendReq(){"dw"==ss_type?get_dw_data(1):get_dz_data(1)}function get_dz_data(e){var t=new AjaxJsonRequest("addr_list.jsp");"true"===is_qr&&sessionStorage.qr_system_id?(t.setData("systemid",sessionStorage.qr_system_id),sessionStorage.qr_system_id=""):(t.setData("key_addr",keyword_eternal),t.setData("dztype",ss_type)),t.setPageNumber(e),t.send("地址搜索中",function(t){saveSsdzlb(t),cache_search(t.pages[0],e,ss_type),initPagination(t.pages[0].tsize,e),common_success_cb(t.datas)},function(e){common_error_cb("地址",e)})}function get_dw_data(e){var t=new AjaxJsonRequest("dw_list.jsp");t.setData("dztype",""),t.setData("dwmc",keyword_eternal),t.setPageNumber(e),t.send("单位搜索中",function(t){saveSsdwlb(t),cache_search(t.pages[0],e,"dw"),initPagination(t.pages[0].tsize,e),common_success_cb(t.datas)},function(e){common_error_cb("单位",e)})}function cache_search(e,t,s){save_is_cache_search(e.tsize,t,s)}function common_success_cb(e){set_img_type(ss_type),create_list(e)}function common_error_cb(e,t){$.alert("搜索"+e+"失败："+t),ss_type=ss_type_last,set_img_type(ss_type)}function create_list(e){$(".to-top").click(),$("#result_list").hide(),$("#result_list").empty(),$("#dz_list_nodata").hide(),e.length>0?($("#dz_list_nodata").hide(),e.forEach(function(e){var t=createItem(e);$("#result_list").append(t)}),$("#result_list").fadeIn(),is_search_sfz&&1==e.length&&(save_is_sfz_search(1),$(".address-card-menu:eq(2)").click())):$("#dz_list_nodata").fadeIn(),isFirst&&($("#history_content").hide(),$("#result_content").fadeIn()),is_search_sfz=!1}function initPagination(e,t){t=parseInt(t),$(".M-box").pagination({showData:15,totalData:e,current:t,jump:!0,coping:!0,count:3,homePage:"首页",endPage:"末页",callback:function(e){"dw"===ss_type?get_dw_data(e.getCurrent()):get_dz_data(e.getCurrent())}},function(e){pagination=e}),e>15?$(".M-box").show():$(".M-box").hide()}setCurrentCategory("ss");var isFirst=!0,ss_type="",pagination,tsize=30,currentpage=1,q="",ss_type_last="",isTheSameType=!0,keyword_eternal,is_cache_search=get_is_cache_search(),is_search_sfz=!1,is_qr=getArgs().is_qr;$(document).on("refresh",".pull-to-refresh-content",function(e){setTimeout(function(){saveSsdzlb(),saveSsdwlb(),isFirst=!0,$("#result_content").hide(),$("#dz_list_nodata").hide(),$("#history_list").empty(),$("#result_list").empty(),$("#history_content").show(),set_img_type(""),ss_type_last="",keyword_eternal="",$("#search").val(""),showHistory(),$.pullToRefreshDone(".pull-to-refresh-content")},0)});