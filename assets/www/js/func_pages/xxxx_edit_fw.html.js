function prepare_for_new(){$('input[name = "czlx"]').val("xz"),$('input[value="正常"]').attr("checked","checked")}function prepare_for_edit(a){if(loadDataToForm(a),$('input[name = "czlx"]').val("bg"),init_fd_zjlx(a.fdzjlx),init_dgr_zjlx(a.glyzjlx),"yes"!==sessionStorage.is_zj){if(""!==a.gzyy){isgzxx=!0,$('input[value="关注"]').attr("checked","checked"),$("#gzgz").show();var n=a.gzyy.split(";");n.forEach(function(a){for(var n=a.split("*"),e=0;e<gzyyZw.length;e++){var t='input[name="'+gzyyObj[e]+'"]',l='textarea[name="'+gzyyObj[e]+'_m"]',i="#"+gzyyObj[e]+"_d";gzyyZw[e]==n[0]&&($(t).attr("checked",!0),$(l).val(n[1]),$(i).show())}})}else"重点"==a.sfgz?$('input[value="重点"]').attr("checked","checked"):$('input[value="正常"]').attr("checked","checked");if(a.afqk){var e=a.afqk.split(";");e.forEach(function(a){for(var n=a.split("*"),e=0;e<afqkZw.length;e++){var t='input[name="'+afqkObj[e]+'"]',l='input[name="'+afqkObj[e]+'_s"]',i="#"+afqkObj[e]+"_d";afqkZw[e]==n[0]&&($(t).attr("checked",!0),$(l).val(n[1]),$(i).show())}})}}}function prepare_for_watch(){$("#save_btn").hide(),$("#wp_tab").hide(),$("img").removeAttr("onclick");var a=new AjaxJsonRequest("house_list.jsp");a.setData("systemid",systemid),a.send("房屋信息获取中",function(a){prepare_for_edit(a.datas[0]),closeAllInput("form")},function(a){$.alert("房屋信息获取失败"),closeAllInput("form")})}function common_prepare(){$('input[type="checkbox"]').on("click",function(a){var n="#"+$(this).prop("name")+"_d";$(this).prop("checked")?$(n).show():$(n).hide()})}function isGzxx(a){"正常"==a||"重点"==a?(isgzxx=!1,$("#gzgz").hide(),gzyy=""):(isgzxx=!0,$("#gzgz").show())}function change_sfczw(a){a.indexOf("租")>-1?$('input[name="sfczw"]').val("是"):"自用"===a?$('input[name="sfczw"]').val("否"):($('input[name="sfczw"]').val(""),$('input[name="sfczw"]').attr("placeholder","请选择是否出租房屋"))}function get_jwry_xx(a,n,e){var t=new AjaxJsonRequest("syrk_jwry_list.jsp");t.setData("zjlx",n),t.setData("zjhm",e),t.send("正在获取境外人员信息",function(n){if(n.datas.length>0){var e=n.datas[0];1===a?($('input[name="fzgj"]').val(e.gj),$('input[name="fdxm"]').val(e.zwxm),$('input[name="fd_ywx"]').val(e.ywx),$('input[name="fd_ywm"]').val(e.ywm),$('input[name="fdlxfs"]').val(e.lxfs)):2===a&&($('input[name="glr_gj"]').val(e.gj),$('input[name="glyxm"]').val(e.zwxm),$('input[name="glr_ywx"]').val(e.ywx),$('input[name="glr_ywm"]').val(e.ywm),$('input[name="glylxfs"]').val(e.lxfs))}else 1===a?($('input[name="fzgj"]').val(""),$('input[name="fdxm"]').val(""),$('input[name="fd_ywx"]').val(""),$('input[name="fd_ywm"]').val(""),$('input[name="fdlxfs"]').val("")):2===a&&($('input[name="glr_gj"]').val(""),$('input[name="glyxm"]').val(""),$('input[name="glr_ywx"]').val(""),$('input[name="glr_ywm"]').val(""),$('input[name="glylxfs"]').val("")),$.alert("没有找到对应境外人员信息，请手动采集")},function(a){$.alert("引用境外人员信息失败："+a)})}function go_back(){history.go(-1)}function subtractAf(a){var n='input[name="'+a+'_s"]',e=$(n).val();e>0&&(e--,$(n).val(e))}function addAf(a){var n='input[name="'+a+'_s"]',e=$(n).val();e++,$(n).val(e)}function create_wp_common_callback(a){a>0?($("#btn_save").show(),$("#add_wp_img").show(),$("#wpTab_nodata").hide()):($("#btn_save").hide(),$("#add_wp_img").hide(),$("#wpTab_nodata").show())}function openDict(a,n,e,t){"房屋现状"==a?openDictDialogWithCallback(a,n,e,t,function(a,n){change_sfczw(n)}):"fdzjlx"===e?openDictDialogWithCallback(a,n,e,t,function(a,n){init_fd_zjlx(n),$('input[name="fdzjhm"]').val(""),$('input[name="fzgj"]').val(""),$('input[name="fdxm"]').val(""),$('input[name="fd_ywx"]').val(""),$('input[name="fd_ywm"]').val(""),$('input[name="fdlxfs"]').val("")}):"glyzjlx"===e?openDictDialogWithCallback(a,n,e,t,function(a,n){init_dgr_zjlx(n),$('input[name="glyzjhm"]').val(""),$('input[name="glr_gj"]').val(""),$('input[name="glyxm"]').val(""),$('input[name="glr_ywx"]').val(""),$('input[name="glr_ywm"]').val(""),$('input[name="glylxfs"]').val("")}):openDictDialog(a,n,e,t)}function init_fd_zjlx(a){"居民身份证"===a||""===a?($("#fzgj").hide(),$("#fd_ywx").hide(),$("#fd_ywm").hide(),$("#fd_ts").hide()):($("#fzgj").show(),$("#fd_ywx").show(),$("#fd_ywm").show(),$("#fd_ts").show())}function init_dgr_zjlx(a){"居民身份证"===a||""===a?($("#glygj").hide(),$("#dgr_ywx").hide(),$("#dgr_ywm").hide(),$("#dgr_ts").hide()):($("#glygj").show(),$("#dgr_ywx").show(),$("#dgr_ywm").show(),$("#dgr_ts").show())}function openDictInForm(a,n,e,t,l){openDictDialogInForm(a,n,e,t,l)}var quxcun=get_current_quxcun(),all_full_addr=get_current_all_full_addr(),systemid=get_current_system_id(),procmode=getArgs().procmode,gzyy="",afqk="",isgzxx=!1,form_num=-1,i=0,datafw=getFwlb()[0],gzyyObj=["gzyy_rzf","gzyy_shy","gzyy_wf","gzyy_zafz","gzyy_qt"],gzyyZw=["日租房","三合一","危房","治安复杂","其他"],afqkObj=["afqk_zg","afqk_wtgl","afqk_zbs","afqk_mj","afqk_jktt","afqk_fkxt","afqk_plxt","afqk_mhq","afqk_xfs"],afqkZw=["自管","委托管理","值班室","门禁","监控探头","访客系统","喷淋系统","灭火器","消防栓"];window.onload=function(){$("#quxcun").html(quxcun),$("#all_full_addr").html(all_full_addr),"PMUPDATE"===procmode?prepare_for_edit(datafw):"PMINSERT"==procmode?prepare_for_new():"PMDETAIL"==procmode&&prepare_for_watch(),common_prepare(),"yes"===sessionStorage.is_zj&&($("#fw_info1").remove(),$("#fw_info2").remove(),$("#fw_info3").remove(),$("#fw_info4").remove(),$("#fw_info5").remove(),$("#gzgz").remove(),$("#wp_tab").remove())},$(function(){"yes"===sessionStorage.is_zj?$("#save_btn").click(function(){var a=new AjaxJsonRequest("house_save_zj.jsp");a.loadDataFromForm("form");var n=new NotNullField,e=$('input[name="fdzjhm"]').val(),t=$('input[name="fdxm"]').val(),l=$('input[name="fdlxfs"]').val(),i=$('input[name="glyzjhm"]').val(),f=$('input[name="glyxm"]').val(),d=$('input[name="glylxfs"]').val();if(""==e&&""==t&&""==l&&""==i&&""==f&&""==d)return void $.alert("房东、代管人必须选填一人");if(""===e&&""===t&&""===l||""!=i||""!=f||""!=d)if(""!=e||""!=t||""!=l||""===i&&""===f&&""===d){if(""==e||""==t||""==l||""==i||""==f||""==d)return void $.alert("如果房东、代管人只填写了其中一个，请清空另外一个的信息")}else n.add("glyzjhm","代管人证件号码"),n.add("glyxm","代管人姓名"),n.add("glylxfs","代管人联系电话");else n.add("fdzjhm","房东证件号码"),n.add("fdxm","房东姓名"),n.add("fdlxfs","房东联系电话");a.setNotNotNullField(n),a.setData("systemid",systemid),a.setData("all_full_addr",all_full_addr),a.send("房屋信息提交中...",function(a){showTchToast("房屋信息保存成功","-1",function(){go_back()})},function(a){$.alert(a)})}):($("#save_btn").click(function(){var a=new AjaxJsonRequest("house_save.jsp");if(isgzxx){var n=["gzyy_rzf","gzyy_shy","gzyy_wf","gzyy_zafz","gzyy_qt"];n.forEach(function(a){var n='input[name="'+a+'"]',e='textarea[name="'+a+'_m"]';$(n).prop("checked")&&(gzyy+=$(n).val(),gzyy+="*",gzyy+=$(e).val(),gzyy+=";")})}else gzyy="";var e="";if(afqkObj.forEach(function(a){var n='input[name="'+a+'"]',t='input[name="'+a+'_s"]';if($(n).prop("checked")){if(parseInt($(t).val())<0)return void(e=$(n).val()+"不能小于0");afqk+=$(n).val(),afqk+="*",afqk+=$(t).val(),afqk+=";"}}),""!=e)return void $.alert("安防情况："+e);a.loadDataFromForm("form");var t=new NotNullField;t.add("sfczw","是否出租房屋"),t.add("fwlb","房屋类型"),t.add("fwxzh","房屋性质"),t.add("fwyt","房屋用途"),t.add("fwxz","房屋现状");var l=$('input[name="fdzjhm"]').val(),i=$('input[name="fdxm"]').val(),f=$('input[name="fdlxfs"]').val(),d=$('input[name="glyzjhm"]').val(),o=$('input[name="glyxm"]').val(),r=$('input[name="glylxfs"]').val();if(""==l&&""==i&&""==f&&""==d&&""==o&&""==r)return void $.alert("房东、代管人必须选填一人");if(""===l&&""===i&&""===f||""!=d||""!=o||""!=r)if(""!=l||""!=i||""!=f||""===d&&""===o&&""===r){if(""==l||""==i||""==f||""==d||""==o||""==r)return void $.alert("如果房东、代管人只填写了其中一个，请清空另外一个的信息")}else t.add("glyzjhm","代管人证件号码"),t.add("glyxm","代管人姓名"),t.add("glylxfs","代管人联系电话");else t.add("fdzjhm","房东证件号码"),t.add("fdxm","房东姓名"),t.add("fdlxfs","房东联系电话");a.setNotNotNullField(t);var m=JSON.stringify(load_wp_data());a.setData("wpxx",m),a.setData("gzyy",gzyy),a.setData("afqk",afqk),a.setData("systemid",systemid),a.setData("all_full_addr",all_full_addr),a.send("房屋信息提交中...",function(a){showTchToast("房屋信息保存成功","-1",function(){go_back()})},function(a){$.alert(a)})}),$('input[name="fdzjhm"]').blur(function(){var a=$('input[name="fdzjlx"]').val(),n=$('input[name="fdzjhm"]').val();"居民身份证"==a?getSfzXx(n,"fdxm","fdlxfs","","","",""):get_jwry_xx(1,a,n)}),$('input[name="glyzjhm"]').blur(function(){var a=$('input[name="glyzjlx"]').val(),n=$('input[name="glyzjhm"]').val();"居民身份证"==a?getSfzXx(n,"glyxm","glylxfs","","","",""):get_jwry_xx(2,a,n)}))});