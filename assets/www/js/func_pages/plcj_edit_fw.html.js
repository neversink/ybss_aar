function prepare_for_new(){$('input[name = "czlx"]').val("xz"),$('input[value="正常"]').attr("checked","checked")}function common_prepare(){$('input[type="checkbox"]').on("click",function(a){var n="#"+$(this).prop("name")+"_d";$(this).prop("checked")?$(n).show():$(n).hide()})}function isGzxx(a){"正常"==a?(isgzxx=!1,$("#gzgz").hide(),gzyy=""):(isgzxx=!0,$("#gzgz").show())}function change_sfczw(a){a.indexOf("租")>-1?$('input[name="sfczw"]').val("是"):"自用"===a?$('input[name="sfczw"]').val("否"):($('input[name="sfczw"]').val(""),$('input[name="sfczw"]').attr("placeholder","请选择是否出租房屋"))}function get_jwry_xx(a,n,t){var l=new AjaxJsonRequest("syrk_jwry_list.jsp");l.setData("zjlx",n),l.setData("zjhm",t),l.send("正在获取境外人员信息",function(n){if(n.datas.length>0){var t=n.datas[0];1===a?($('input[name="fzgj"]').val(t.gj),$('input[name="fdxm"]').val(t.zwxm),$('input[name="fd_ywx"]').val(t.ywx),$('input[name="fd_ywm"]').val(t.ywm),$('input[name="fdlxfs"]').val(t.lxfs)):2===a&&($('input[name="glr_gj"]').val(t.gj),$('input[name="glyxm"]').val(t.zwxm),$('input[name="glr_ywx"]').val(t.ywx),$('input[name="glr_ywm"]').val(t.ywm),$('input[name="glylxfs"]').val(t.lxfs))}else 1===a?($('input[name="fzgj"]').val(""),$('input[name="fdxm"]').val(""),$('input[name="fd_ywx"]').val(""),$('input[name="fd_ywm"]').val(""),$('input[name="fdlxfs"]').val("")):2===a&&($('input[name="glr_gj"]').val(""),$('input[name="glyxm"]').val(""),$('input[name="glr_ywx"]').val(""),$('input[name="glr_ywm"]').val(""),$('input[name="glylxfs"]').val("")),$.alert("没有找到对应境外人员信息，请手动采集")},function(a){$.alert("引用境外人员信息失败："+a)})}function go_back(){history.go(-1)}function subtractAf(a){var n='input[name="'+a+'_s"]',t=$(n).val();t>0&&(t--,$(n).val(t))}function addAf(a){var n='input[name="'+a+'_s"]',t=$(n).val();t++,$(n).val(t)}function create_wp_common_callback(a){a>0?($("#btn_save").show(),$("#add_wp_img").show(),$("#wpTab_nodata").hide()):($("#btn_save").hide(),$("#add_wp_img").hide(),$("#wpTab_nodata").show())}function openDict(a,n,t,l){"房屋现状"==a?openDictDialogWithCallback(a,n,t,l,function(a,n){change_sfczw(n)}):"fdzjlx"===t?openDictDialogWithCallback(a,n,t,l,function(a,n){init_fd_zjlx(n),$('input[name="fdzjhm"]').val(""),$('input[name="fzgj"]').val(""),$('input[name="fdxm"]').val(""),$('input[name="fd_ywx"]').val(""),$('input[name="fd_ywm"]').val(""),$('input[name="fdlxfs"]').val("")}):"glyzjlx"===t?openDictDialogWithCallback(a,n,t,l,function(a,n){init_dgr_zjlx(n),$('input[name="glyzjhm"]').val(""),$('input[name="glr_gj"]').val(""),$('input[name="glyxm"]').val(""),$('input[name="glr_ywx"]').val(""),$('input[name="glr_ywm"]').val(""),$('input[name="glylxfs"]').val("")}):openDictDialog(a,n,t,l)}function init_fd_zjlx(a){"居民身份证"===a?($("#fzgj").hide(),$("#fd_ywx").hide(),$("#fd_ywm").hide(),$("#fd_ts").hide()):($("#fzgj").show(),$("#fd_ywx").show(),$("#fd_ywm").show(),$("#fd_ts").show())}function init_dgr_zjlx(a){"居民身份证"===a?($("#glygj").hide(),$("#dgr_ywx").hide(),$("#dgr_ywm").hide(),$("#dgr_ts").hide()):($("#glygj").show(),$("#dgr_ywx").show(),$("#dgr_ywm").show(),$("#dgr_ts").show())}function openDictInForm(a,n,t,l,e){openDictDialogInForm(a,n,t,l,e)}var addr_name=getArgs().addr_name,gzyy="",afqk="",isgzxx=!1,form_num=-1,i=0,plcj_data,gzyyObj=["gzyy_rzf","gzyy_shy","gzyy_wf","gzyy_zafz","gzyy_qt"],gzyyZw=["日租房","三合一","危房","治安复杂","其他"],afqkObj=["afqk_zg","afqk_wtgl","afqk_zbs","afqk_mj","afqk_jktt","afqk_fkxt","afqk_plxt","afqk_mhq","afqk_xfs"],afqkZw=["自管","委托管理","值班室","门禁","监控探头","访客系统","喷淋系统","灭火器","消防栓"];window.onload=function(){plcj_data=JSON.parse(get_plcj_dz());var a="";plcj_data.forEach(function(n,t){a+=t+". "+n.all_full_addr,t<plcj_data.length&&(a+="<br>")}),$("#all_full_addr").html(a),prepare_for_new(),common_prepare()},$(function(){$("#save_btn").click(function(){var a=new AjaxJsonRequest("house_save_pl.jsp");if(isgzxx){var n=["gzyy_rzf","gzyy_shy","gzyy_wf","gzyy_zafz","gzyy_qt"];n.forEach(function(a){var n='input[name="'+a+'"]',t='textarea[name="'+a+'_m"]';$(n).prop("checked")&&(gzyy+=$(n).val(),gzyy+="*",gzyy+=$(t).val(),gzyy+=";")})}else gzyy="";var t="";if(afqkObj.forEach(function(a){var n='input[name="'+a+'"]',l='input[name="'+a+'_s"]';if($(n).prop("checked")){if(parseInt($(l).val())<0)return void(t=$(n).val()+"不能小于0");afqk+=$(n).val(),afqk+="*",afqk+=$(l).val(),afqk+=";"}}),""!=t)return void $.alert("安防情况："+t);a.loadDataFromForm("form");var l=new NotNullField;l.add("sfczw","是否出租房屋"),l.add("fwlb","房屋类型"),l.add("fwxzh","房屋性质"),l.add("fwyt","房屋用途"),l.add("fwxz","房屋现状");var e=$('input[name="fdzjhm"]').val(),i=$('input[name="fdxm"]').val(),f=$('input[name="fdlxfs"]').val(),d=$('input[name="glyzjhm"]').val(),m=$('input[name="glyxm"]').val(),_=$('input[name="glylxfs"]').val();if(""==e&&""==i&&""==f&&""==d&&""==m&&""==_)return void $.alert("房东、代管人必须选填一人");if(""===e&&""===i&&""===f||""!=d||""!=m||""!=_)if(""!=e||""!=i||""!=f||""===d&&""===m&&""===_){if(""==e||""==i||""==f||""==d||""==m||""==_)return void $.alert("如果房东、代管人只填写了其中一个，请清空另外一个的信息")}else l.add("glyzjhm","代管人证件号码"),l.add("glyxm","代管人姓名"),l.add("glylxfs","代管人联系电话");else l.add("fdzjhm","房东证件号码"),l.add("fdxm","房东姓名"),l.add("fdlxfs","房东联系电话");var u=JSON.stringify(load_wp_data());a.setData("wpxx",u),a.setData("gzyy",gzyy),a.setData("afqk",afqk);var g=[];plcj_data.forEach(function(a){var n={};n.systemid=a.systemid,n.all_full_addr=a.all_full_addr,"是"===a.ishouse?n.czlx="bg":"否"===a.ishouse&&(n.czlx="xz"),g.push(n)}),a.setData("plcj",JSON.stringify(g)),a.send("房屋信息提交中...",function(a){showTchToast("房屋信息保存成功","-1",function(){go_back()})},function(a){$.alert(a)})}),$('input[name="fdzjhm"]').blur(function(){var a=$('input[name="fdzjlx"]').val(),n=$('input[name="fdzjhm"]').val();"居民身份证"==a?getSfzXx(n,"fdxm","fdlxfs","","","",""):get_jwry_xx(1,a,n)}),$('input[name="glyzjhm"]').blur(function(){var a=$('input[name="glyzjlx"]').val(),n=$('input[name="glyzjhm"]').val();"居民身份证"==a?getSfzXx(n,"glyxm","glylxfs","","","",""):get_jwry_xx(2,a,n)})});