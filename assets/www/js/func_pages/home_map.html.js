function init(){get_userid(),getCurrentPosition(successInitCallback,failedInitCallback),$("#my_location").click(function(){ifLocating(!0),getCurrentPosition(successCallback,failedCallback)})}function get_userid(){var e=sessionStorage.login_status;if("true"!==e){var s=navigator.userAgent.indexOf("Android")>-1,t=getArgs().username,o=getArgs().userid;s?(console.log("is_android"),wormhole.traversing(function(e){e.userid?(sessionStorage.userid=e.userid?e.userid:"",sessionStorage.username=e.username?e.username:"",sessionStorage.zj_systemid=e.zj_systemid?e.zj_systemid:"",sessionStorage.zj_all_full_addr=e.zj_all_full_addr?e.zj_all_full_addr:"",sessionStorage.is_zj=e.is_zj?e.is_zj:"",sessionStorage.login_status="true",console.log("是否中介11"),console.log(sessionStorage.is_zj),"yes"===sessionStorage.is_zj&&(sessionStorage.current_system_id=sessionStorage.zj_systemid,sessionStorage.current_all_full_addr=sessionStorage.zj_all_full_addr,location.replace("addr_xxxx.html"))):$.alert("获取用户ID为空!")},function(e){$.alert("获取用户ID失败!")},"")):o?(console.log("is_iOS"),sessionStorage.userid=o?o:"",sessionStorage.username=t?t:"",sessionStorage.zj_systemid=zj_systemid?zj_systemid:"",sessionStorage.zj_all_full_addr=zj_all_full_addr?zj_all_full_addr:"",sessionStorage.is_zj=is_zj?is_zj:"",sessionStorage.login_status="true",console.log("是否中介22"),console.log(sessionStorage.is_zj),"yes"===sessionStorage.is_zj&&(sessionStorage.current_system_id=zj_systemid,sessionStorage.current_all_full_addr=zj_all_full_addr,location.replace("addr_xxxx.html"))):$.alert("获取用户ID失败!")}}function ifLocating(e){e?$("#my_location").attr("src","img/mylocating.png"):$("#my_location").attr("src","img/mylocation.png")}function successCallback(e){var s=e.lontitude,t=e.latitude,o=new AMap.LngLat(s,t),a=new AjaxJsonRequest("addr_list.jsp");a.setData("dztype","fjfw"),a.setData("mapx",s),a.setData("mapy",t),a.setPages(1,15,-1),a.send("附近地址获取中",function(e){saveFjdzlb(e,o),save_is_cache_near("1"),showMarker(e.datas,o)},function(e){ifLocating(!1),$.alert("加载附近地址失败："+e)})}function failedCallback(e){ifLocating(!1),$.alert("定位失败")}function showMarker(e,s){map.clearMap(),map.setCenter(s),current_circle.setMap(map),current_circle.setCenter(s),e.forEach(function(e){var s=new AMap.Marker({map:map,icon:"./img/location_b.png",position:[e.mapx,e.mapy],offset:new AMap.Pixel(-10,-34),animation:"AMAP_ANIMATION_DROP"});s.on("click",function(){infoWindow=new AMap.InfoWindow({content:createInfoWindow(e),offset:new AMap.Pixel(-2,-25)}),infoWindow.open(map,s.getPosition()),lastMarker&&(lastMarker.setIcon(lastIcon),lastMarker.setDraggable(!1)),lastMarker=s,lastIcon=s.getIcon(),s.setIcon("./img/location_r.png"),this.setTop(!0)})}),map.setFitView(),ifLocating(!1)}function successInitCallback(e){var s=e.lontitude,t=e.latitude,o=new AMap.LngLat(s,t);map.setCenter(o),console.log("定位成功:"+s+","+t)}function failedInitCallback(){$.alert("定位失败"),console.log("定位失败")}function back_to_native(){tchBackToNative()}function startQr(){tchScanQrcode(function(e){if(console.log("扫描内容"),console.log(e),1==e.cancelled);else try{var s,t=e.text;t.indexOf("systemid=")>-1?(s=t.substring(t.indexOf("systemid=")+9,t.indexOf("systemid=")+9+36),console.log(s)):(s=t.substring(t.indexOf("addr?id=")+8,t.indexOf("addr?id=")+8+36),console.log(s)),36===s.length?(window.location.href="nav_search.html?is_qr=true",sessionStorage.qr_system_id=s):$.alert("未正确识别地址二维码！")}catch(e){$.alert("地址二维码识别出错"),console.log("截取systemid出错"),console.log(e)}},function(e){$.alert("地址二维码识别出错"),console.log("调用二维码识别出错"),console.log(e)},"")}var lastMarker,lastIcon,infoWindow;