function init(){if("PMUPDATE"===procmode&&"recreate"!==type){var t=getArgs().all_full_addr;$(".top-title").html("境内人员移动"),$("#quxcun").html("转移地址："+t),$("#all_full_addr").html("原地址："+all_full_addr),$('input[name="systemid"]').val(getArgs().systemid),$('input[name="all_full_addr"]').val(t),$('input[name="procmode"]').val("PMINSERT")}else $("#quxcun").html(quxcun),$("#all_full_addr").html(all_full_addr),$('input[name="systemid"]').val(systemid),$('input[name="all_full_addr"]').val(all_full_addr),$('input[name="procmode"]').val("PMINSERT");"PMINSERT"===procmode?prepare_for_new():"PMUPDATE"===procmode?prepare_for_edit():"PMDETAIL"===procmode?prepare_for_watch():"PMEDIT"===procmode&&($('input[name="czlx"]').val("bg"),$('input[name="procmode"]').val("PMINSERT"),$.alert("仅能修改健康状况和是否渔船民"),ryxxData=getCurrentRyItem(),show_jnry_content(ryxxData,!1),$("#clxx_content").hide(),closeAllInput("form"),$('input[name="sfycm"]').removeAttr("disabled"),$('input[name="jkzk"]').removeAttr("disabled"))}function prepare_for_new(){$('input[name="czlx"]').val("xz"),$('input[value="正常"]').attr("checked","checked"),$("#smrz_btn").show(),init_fwxx()}function init_fwxx(){var t=getFwlb()[0];if("yes"===sessionStorage.is_zj)$("#zjcs").val("租赁房屋"),$("#li_jzcs").hide();else{var e=new AjaxJsonRequest("house_list.jsp");e.setData("systemid",get_current_system_id()),e.send("房屋信息获取中",function(e){e.datas.length>0&&(t=e.datas[0]),t?"是"==t.sfczw?($("#zjcs").val("租赁房屋"),$("#zjcs").attr("onclick","")):"否"==t.sfczw&&($("#zjcs").val("普通住宅"),$("#zjcsbm").val("20"),$("#zjcs").attr("onclick","zjcs_onclick_2()")):$("#zjcs").attr("onclick","zjcs_onclick_1()")},function(t){$.alert("房屋信息获取失败不能增加境内人员，"+t),go_back()})}}function zjcs_onclick_none(){$.alert("未成功获取房屋信息，请返回刷新界面!")}function zjcs_onclick_1(){openLocalDictDialog("居住处所","居住处所_未知房屋类别_本地","zjcs","zjcsbm")}function zjcs_onclick_2(){openLocalDictDialog("居住处所","居住处所_非出租房屋_本地","zjcs","zjcsbm")}function prepare_for_edit(){$('input[name="czlx"]').val("xz"),$("#zjcs").attr("onclick","zjcs_onclick_1()");var t,e=getArgs().rkbm;if(e){var n=new AjaxJsonRequest("syrk_list.jsp");n.setData("rkbm",e),n.send("获取境内人员详情中...",function(e){e.datas.length>0?(t=e.datas[0],show_jnry_content(t,!1)):$.alert("查询境内人员详情失败!")},function(t){$.alert("获取境内人员详情失败!")})}else"PMUPDATE"===procmode&&"recreate"!==type?(t=getCurrentRyItem(),"流动人口"===t.syrklb?(t=getCurrentRyItem(),show_jnry_content(t,!1)):($('input[name="zjhm"]').val(t.pid_y),$('input[name="zjhm"]').blur())):(t=getCurrentRyItem(),show_jnry_content(t,!1))}function prepare_for_watch(){var t,e=getArgs().rkbm;if(e){var n=new AjaxJsonRequest("syrk_list.jsp");n.setData("rkbm",e),n.send("获取境内人员详情中...",function(e){e.datas.length>0?(t=e.datas[0],show_jnry_content(t,!0),show_car_and_boat(t.pid_y,!1)):($.alert("查询境内人员详情失败!"),closeAllInput("form"))},function(t){$.alert("获取境内人员详情失败!"),closeAllInput("form")})}else t=getCurrentRyItem(),show_jnry_content(t,!0),show_car_and_boat(t.pid_y,!1)}function show_car_and_boat(t,e){if("yes"!==sessionStorage.is_zj){var n=new AjaxJsonRequest("wp_list.jsp");n.setData("systemid",systemid),n.setData("sfzh",t),n.simpleSend(function(t){t.datas.length>0&&(t.datas.forEach(function(t){add_item_with_data(t,e)}),$("#clxx_content").show()),e||$("[src='img/cj_add.png']").hide()},function(t){$.alert("车船信息获取失败，"+t)})}}function show_jnry_content(t,e){t.huji_qu.length>0&&t.huji_dz.length>0&&t.huji_dz.indexOf(t.huji_qu)>=0&&(t.huji_dz=t.huji_dz.substring(t.huji_qu.length)),loadDataToForm(t),e?$('input[name="zjhm"]').val(t.pid):$('input[name="zjhm"]').val(t.pid_y),$('input[name="gzdw"]').val(t.cydw),$('input[name="zz"]').val(t.cyzk_zy),$('input[name="person_id"]').val(t.rkbm),setup_current_rklb(t.syrklb),console.log(t.syrklb),e&&($("#save_btn_div").hide(),$("#clxx_content").hide(),closeAllInput("form"))}function common_prepare(){}function setup_current_rklb(t){status=t,"人户一致"==t?change_nnf(1):"有人无户"==t||"有户无人"===t?(change_dict(2),change_nnf(2)):"流动人口"==t?(change_dict(3),change_nnf("yes"===sessionStorage.is_zj?5:3)):"已登记"==t&&change_dict(4)}function alert_current_rklb(t){"PMUPDATE"===procmode&&"recreate"!==type?"人户一致"==t?$.alert("此人户籍地址为要移动的地址<br>请到对应地址上的人员列表界面进行核实!"):"已登记"==t&&$.alert("此人已经在要移动的地址上登记过<br>请到对应地址上的人员列表界面进行核实!"):"人户一致"==t?$.alert("此人户籍地址为当前地址<br>请返回人员列表界面进行核实!"):"已登记"==t&&$.alert("此人已经在当前地址登记过<br>请返回人员列表界面进行核实!")}function change_dict(t){switch(t){case 1:$("#zjzsj_div").html('居住时间<span class="table-redstar" id="zjzsj_redot"></span>'),$("#zjzyy_div").html('居住原因<span class="table-redstar" id="zjzyy_redot"></span>'),$("#zzsy").attr("onclick","zjzyy_1_click()");break;case 2:$("#zjzsj_div").html('居住时间<span class="table-redstar" id="zjzsj_redot"></span>'),$("#zjzyy_div").html('居住原因<span class="table-redstar" id="zjzyy_redot"></span>'),$("#zzsy").attr("placeholder","请选择居住原因"),$("#zzsj").attr("placeholder","请输入居住时间"),$("#zzsy").attr("onclick","zjzyy_2_click()");break;case 3:$("#zjzsj_div").html('暂住时间<span class="table-redstar" id="zjzsj_redot"></span>'),$("#zjzyy_div").html('暂住原因<span class="table-redstar" id="zjzyy_redot"></span>'),$("#zzsy").attr("placeholder","请选择暂住原因"),$("#zzsj").attr("placeholder","请输入暂住时间"),$("#zzsy").attr("onclick","zjzyy_3_click()");break;case 4:$("#zzsy").attr("onclick","zjzyy_4_click()")}}function zjzyy_none_click(){$.alert("请先输入身份证号码<br>再继续后续采集")}function zjzyy_1_click(){$.alert("此人户籍地址为当前地址<br>请返回人员列表界面进行核实!")}function zjzyy_2_click(){openDict("居住事由","境内人员居住原因","zzsy","zzsybm")}function zjzyy_3_click(){openDict("暂住事由","境内人员暂住原因","zzsy","zzsybm")}function zjzyy_4_click(){$.alert("此人已经在当前登记过<br>请返回人员列表界面进行核实!")}function change_nnf(t){switch(nnf.clear(),nnf.add("zjhm","证件号码"),nnf.add("name","姓名"),nnf.add("lxfs","联系方式"),$("#zjzyy_redot").html(""),$("#zjzsj_redot").html(""),$("#ssqx_redot").html(""),$("#hjdxz_redot").html(""),t){case 1:break;case 2:$("#zjzyy_redot").html("*"),$("#zjzsj_redot").html("*"),nnf.add("zzsy","居住原因"),nnf.add("zzsj","居住时间");break;case 3:$("#zjzyy_redot").html("*"),$("#zjzsj_redot").html("*"),$("#ssqx_redot").html("*"),$("#hjdxz_redot").html("*"),nnf.add("zzsy","暂住原因"),nnf.add("zzsj","暂住时间"),nnf.add("huji_dz","户籍地详址"),nnf.add("huji_qu","省市区县");break;case 5:$("#zjzyy_redot").html("*"),$("#zjzsj_redot").html("*"),nnf.add("zzsy","暂住原因"),nnf.add("zzsj","暂住时间")}}function sendReq(){if("PMEDIT"===procmode);else if("PMUPDATE"===procmode&&"recreate"!==type){if("已登记"==status)return void $.alert("此人已经在要移动的地址上登记过<br>请到对应地址上的人员列表界面进行核实!");if("人户一致"==status)return void $.alert("此人户籍地址为要移动的地址<br>请到对应地址上的人员列表界面进行核实!")}else{if("已登记"==status)return void $.alert("此人已经在当前地址登记过<br>请返回人员列表界面进行核实!");if("人户一致"==status)return void $.alert("此人户籍地址为当前地址<br>请返回人员列表界面进行核实!")}var t="";if("yes"===sessionStorage.is_zj)t=new AjaxJsonRequest("syrk_jnry_save_zj.jsp"),nnf.add("zjhm","证件号码"),nnf.add("name","姓名"),nnf.add("lxfs","联系方式"),t.setNotNotNullField(nnf),t.loadDataFromForm("form"),t.send("境内人员信息提交中...",function(t){showTchToast("境内人员保存成功","-1",function(){go_back()})},function(t){$.alert("境内人员保存失败，"+t)});else{var e=JSON.stringify(load_cc_data(""));if("false"===e)return;t=new AjaxJsonRequest("syrk_jnry_save.jsp"),nnf.add("zjhm","证件号码"),nnf.add("name","姓名"),nnf.add("lxfs","联系方式"),"PMEDIT"===procmode?(openAllInput("form"),$('select[name="zjlx"]').removeAttr("disabled"),t.loadDataFromForm("form"),closeAllInput("form"),$('input[name="sfycm"]').removeAttr("disabled"),$('input[name="jkzk"]').removeAttr("disabled")):(t.setNotNotNullField(nnf),t.loadDataFromForm("form"),t.setData("wpxx",e)),t.send("境内人员信息提交中...",function(t){showTchToast("境内人员保存成功","-1",function(){go_back()})},function(t){$.alert("境内人员保存失败，"+t)})}}function start_search_car(t){setTimeout(function(){var e=new AjaxJsonRequest("bd_jdc_list.jsp");e.setData("sfzh",t),e.simpleSend(function(t){t.datas.length>0&&(t.datas.forEach(function(t){var e={};e.good_type="车",e.good_name=t.hpzl,e.good_property=t.fzjg.substring(0,1)+t.hphm,e.good_describe1=t.csys,e.good_num=1,add_item_with_data(e,!0)}),create_cc_common_callback($("#car_and_boat").children().length))},function(t){})},0)}function startOcr(){tchRecognizeIDcard(function(t){$('input[name="zjhm"]').val(t.sfz),$('input[name="zjhm"]').blur()},function(t){$.alert("身份证识别失败!")},"")}function fun_smry(){var t=getCurrentRyItem().name,e=getCurrentRyItem().pid_y;smsfzrz(t,e)}function click_fwcs(){$.modal({title:"服务处所",buttons:[{text:"手动输入",onClick:function(){$('input[name="gzdw"]').focus()}},{text:"自动引用",onClick:function(){openSearchDwDialog(quoteDwCallback)}}]})}function click_zy(){$.modal({title:"职业",buttons:[{text:"手动输入",onClick:function(){$('input[name="zz"]').removeAttr("readOnly"),$('input[name="zz"]').focus(),$('input[name="zz"]').on("blur",function(){$('input[name="zz"]').attr("readOnly","true")})}},{text:"自动引用",onClick:function(){openDictDialog("职业","职业","zz","zzbm")}}]})}function quoteDwCallback(t){t?$('input[name="gzdw"]').val(t.frmc?t.frmc:""):$.alert("单位信息引用失败")}function create_cc_common_callback(t){t>0?($("#add_cc_img").show(),$("#ccTab_nodata").hide()):($("#add_cc_img").hide(),$("#ccTab_nodata").show())}function go_back(){history.go(-1)}function openDictInForm(t,e,n,a,r){openDictDialogInForm(t,e,n,a,r)}function openDict(t,e,n,a){openDictDialog(t,e,n,a)}var procmode=getArgs().procmode,type=getArgs().type,quxcun=get_current_quxcun(),all_full_addr=get_current_all_full_addr(),systemid=get_current_system_id(),nnf=new NotNullField,status="",jnry_picker=new mui.DtPicker({type:"date",beginDate:new Date(1900,1,1),endDate:new Date(2099,12,31)});"yes"===sessionStorage.is_zj&&$("#clxx_content").remove(),$(function(){$("#zzsj").click(function(){jnry_picker.show(function(t){$("#zzsj").val(t.text)})}),"yes"===sessionStorage.is_zj?setup_current_rklb("流动人口"):$('input[name="zjhm"]').blur(function(){var t=$('input[name="zjhm"]').val(),e=$('select[name="zjlx"]').val();if(""!=t&&"居民身份证"==e){var n=new AjaxJsonRequest("bjrk_list.jsp");n.setData("sfzh",t),"PMUPDATE"===procmode&&"recreate"!==type?n.setData("systemid",getArgs().systemid):n.setData("systemid",get_current_system_id()),n.send("正在获取人员信息",function(e){if(e.datas.length>0){var n=e.datas[0];if(n.CZRKXM&&n){alert_current_rklb(n.syrklb),setup_current_rklb(n.syrklb),$('input[name="name"]').val(n.CZRKXM?n.CZRKXM:""),$('input[name="lxfs"]').val(n.CZRKLXFS?n.CZRKLXFS:""),$('input[name="gzdw"]').val(n.CZRKFWCS?n.CZRKFWCS:""),$('input[name="zz"]').val(n.CZRKZY?n.CZRKZY:""),$('input[name="person_id"]').val(n.CZRKRYBH?n.CZRKRYBH:""),$('input[name="mz"]').val(n.CZRKMZ?n.CZRKMZ:"");var a=n.CZRKXB?n.CZRKXB:"";switch($('input[name="xb"]').val(a),a){case"男":$('input[name="xbbm"]').val("1");break;case"女":$('input[name="xbbm"]').val("2");break;case"未知的性别":$('input[name="xbbm"]').val("0");break;case"未说明的性别":$('input[name="xbbm"]').val("9")}$('input[name="huji_qu"]').val(n.CZRKSSSSXQ?n.CZRKSSSSXQ:""),""!=n.CZRKSSSSXQ&&""!=n.CZRKZZ&&$('input[name="huji_dz"]').val(n.CZRKZZ.substring(n.CZRKSSSSXQ.length))}else setup_current_rklb(n.syrklb);start_search_car(t)}},function(e){$.alert("获取人员信息失败："+e),start_search_car(t)})}})});