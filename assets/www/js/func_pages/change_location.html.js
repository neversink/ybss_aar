function recoveryPos(){return ifChanged?void $.modal({text:"确定要还原到原始坐标吗？",buttons:[{text:"取消",onClick:function(){}},{text:"确定",onClick:function(){marker.setPosition(new AMap.LngLat(mapx_ori?mapx_ori:mapx_marker,mapy_ori?mapy_ori:mapy_marker)),$("#jd_cur").html(mapx_ori?mapx_ori:"无"),$("#wd_cur").html(mapy_ori?mapy_ori:"无"),map.setFitView(),ifChanged=!1}}]}):void $.modal({text:"您还未修改过坐标",buttons:[{text:"确定",onClick:function(){}}]})}function init(){mapx_marker=parseFloat(getCurrentLng()),mapy_marker=parseFloat(getCurrentLat()),marker=new AMap.Marker({map:map,icon:"./img/location_b.png",offset:new AMap.Pixel(-10,-34),raiseOnDrag:!0,draggable:!0,cursor:"move",animation:"AMAP_ANIMATION_DROP"}),mapx_ori>0&&mapy_ori>0?marker.setPosition(new AMap.LngLat(mapx_ori,mapy_ori)):mapx_marker?marker.setPosition(new AMap.LngLat(mapx_marker,mapy_marker)):getCurrentPosition(function(a){marker.setPosition(new AMap.LngLat(a.lontitude,a.latitude)),mapx_marker=a.lontitude,mapx_marker=a.latitude},function(a){$.alert("获取当前位置失败")}),marker.on("dragstart",function(){}),marker.on("dragging",function(){ifChanged=!0,$("#jd_cur").html(marker.getPosition().getLng()),$("#wd_cur").html(marker.getPosition().getLat())}),marker.on("dragend",function(){$.modal({text:"确定要修改地址到当前坐标吗？",buttons:[{text:"取消",onClick:function(){}},{text:"确定",onClick:function(){var a=new AjaxJsonRequest("addr_dzbz_save.jsp");a.setData("systemid",item_json.systemid),a.setData("all_full_addr",item_json.all_full_addr),a.setData("x",marker.getPosition().getLng()),a.setData("y",marker.getPosition().getLat()),a.setData("alter_type","标注"),a.setData("addr_type",item_json.dztype),a.send("地址标注更新中",function(a){showTchToast("地址标注成功","-1",function(){go_back()})},function(a){$.alert("地址标注失败："+a)})}}]})}),map.setFitView()}function go_back(){history.go(-1)}var item_json=get_current_change_pos_item();$("#all_full_addr").html(item_json.all_full_addr);var mapx_ori=item_json.mapx,mapy_ori=item_json.mapy;$("#jd_ori").html(mapx_ori?mapx_ori:"无"),$("#wd_ori").html(mapy_ori?mapy_ori:"无"),$("#jd_cur").html(mapx_ori?mapx_ori:"无"),$("#wd_cur").html(mapy_ori?mapy_ori:"无");var mapx_marker,mapy_marker,mapx_new,mapy_new,marker,infoWindow,ifChanged=!1;